{% extends "base.html" %}
{% import "bootstrap_wtf.html" as wtf %}

{% block content %}

{% set exercise_icons = {
    'machine': 'fa-solid fa-weight-hanging',
    'free_weight': 'fas fa-dumbbell',
    'bodyweight': 'fa-solid fa-child-reaching',
    'cardio': 'fas fa-person-running'
} %}

<div class="container mt-4">
    <h1 class="text-center mb-4">üèãÔ∏è‚Äç‚ôÇÔ∏è My Workouts</h1>

    <div class="d-flex justify-content-center mb-4">
        <a href="/create-workout" class="btn btn-success btn-lg shadow-sm">
            ‚ûï Create New Workout
        </a>
    </div>

    <div class="mb-3 p-2 bg-light rounded">
        <form method="get" action="{{ url_for('workouts') }}" class="d-inline-block">
            <label for="order_by" class="me-2">Sort By:</label>
            <select name="order_by" id="order_by" class="form-select d-inline w-auto" onchange="this.form.submit()">
                <option value="default" {% if order_by == "default" %}selected{% endif %}>Default</option>
                <option value="exercise_type" {% if order_by == "exercise_type" %}selected{% endif %}>Exercise Type</option>
                <option value="name" {% if order_by == "name" %}selected{% endif %}>Name</option>
            </select>
        </form>
    
        <!-- Icon Legend -->
        <div class="mt-2">
            <strong>Key:</strong>
            {% for key, icon_class in exercise_icons.items() %}
                <span class="me-3">
                    <i class="{{ icon_class }}"></i> {{ key.replace('_', ' ').title() }}
                </span>
            {% endfor %}
        </div>
    </div>
    
    <div class="row g-4">
        {% for workout in workouts %}
        <div class="col-md-6 col-lg-4">      
            <div class="card shadow border-0 h-100 position-relative">
                
                <!-- Card Header -->
                <div class="card-header bg-white border-0 text-center position-relative">
                    <!-- Use relative positioning to nudge the title down -->
                    <h5 class="card-title fw-bold text-primary m-0" style="position: relative; top: 5px;">
                        {% if workout.exercise_type in exercise_icons %}
                            <i class="{{ exercise_icons[workout.exercise_type] }} me-2"></i>
                        {% endif %}
                        {{ workout.name }}
                    </h5>
                </div>
        
                <!-- Ellipsis Menu (Positioned in the top-right corner) -->
                <div class="position-absolute top-0 end-0 m-2">
                    <div class="dropdown">
                        <button class="btn btn-sm" type="button" id="dropdownMenu{{ workout.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                            &#x22EE; <!-- Vertical Ellipsis -->
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenu{{ workout.id }}">
                            <li><a class="dropdown-item" href="{{ url_for('edit_workout', workout_id=workout.id) }}">Edit</a></li>
                            <li>
                                <form method="POST" action="{{ url_for('delete_workout', workout_id=workout.id) }}" onsubmit="return confirm('Are you sure you want to delete this workout?');">
                                    <button type="submit" class="dropdown-item text-danger">Delete</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
        
                <!-- Card Body -->
                <div class="card-body text-center">
                    <form action="{{ url_for('log_exercise', workout_id=workout.id) }}" method="POST">
                        <button type="submit" class="btn btn-outline-primary btn-sm">
                            üìù Log Exercise
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        
        
        {% endfor %}
    </div>
</div>
{% endblock %}
