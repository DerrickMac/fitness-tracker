{% extends "base.html" %} {% block content %}
<script
  type="text/javascript"
  src="https://www.gstatic.com/charts/loader.js"
></script>
<script>
  // Load the calendar package
  google.charts.load("current", { packages: ["calendar"] });
  google.charts.setOnLoadCallback(drawChart);

  async function drawChart() {
    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn({ type: "date", id: "Date" });
    dataTable.addColumn({ type: "number", id: "Activity" });

    const response = await fetch("/api/workouts");
    const data = await response.json();
    const processedData = data.map((entry) => {
      const dateStr = entry[0];
      const value = entry[1];
      const rawDate = new Date(dateStr);
      const stableDate = new Date(
        rawDate.getFullYear(),
        rawDate.getMonth(),
        rawDate.getDate() + 1
      );
      return [stableDate, value];
    });
    dataTable.addRows(processedData);

    var chart = new google.visualization.Calendar(
      document.getElementById("calendar_basic")
    );

    // Get screen width to adjust size
    var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    
    // Adjust size based on screen width
    var chartWidth = screenWidth < 600 ? screenWidth * 0.9 : 800;
    var chartHeight = screenWidth < 600 ? 250 : 350;

    var options = {
      title: "Fitness Activity",
      colorAxis: {
        minValue: 0,
        maxValue: 1,
        colors: ["#EFF3EA", "#399918"],
      },
      noDataPattern: {
        backgroundColor: "#EFF3EA",
        color: "#EFF3EA",
      },
      calendar: {
        cellSize: screenWidth < 600 ? 10 : 16, // Smaller cells for small screens
        monthLabel: {
          fontName: "Arial",
          fontSize: 12,
          color: "#1A1A19",
        },
        monthOutlineColor: {
          stroke: "#FFFFFF",
          strokeOpacity: 0.8,
          strokeWidth: 2,
        },
        unusedMonthOutlineColor: {
          stroke: "#FFFFFF",
          strokeOpacity: 1,
          strokeWidth: 2,
        },
        yearLabel: {
          fontName: "Arial",
          fontSize: 36,
          color: "#1A1A19",
        },
        underMonthSpace: 12,
        underYearSpace: 5,
      },
    };
    chart.draw(dataTable, options);
  }
  // Redraw chart when window resizes
  window.addEventListener('resize', drawChart);
</script>

<body>
  <div id="calendar_basic" style="width: 1000px; height: 350px"></div>
</body>
{% endblock %}
